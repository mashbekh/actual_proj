<!DOCTYPE HTML >
<!-- The HTML 4.01 Transitional DOCTYPE declaration-->
<!-- above set at the top of the file will set     -->
<!-- the browser's rendering engine into           -->
<!-- "Quirks Mode". Replacing this declaration     -->
<!-- with a "Standards Mode" doctype is supported, -->
<!-- but may lead to some differences in layout.   -->

<html lang="en">

<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>Tax System</title>

<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script
	src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.1/jquery-ui.js"
	type="text/javascript"></script>
<link
	href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.1/themes/blitzer/jquery-ui.css"
	rel="stylesheet" type="text/css" />

<link rel="stylesheet" href="jarvis/css/jquery.flexdatalist.min.css">
<link rel="stylesheet" href="jarvis/css1/bootstrap.min.css">

<script type="text/javascript" src="jarvis/js/bootstrap.min.js"></script>
			<script src="jarvis/js/moment_locale.js"></script>
			<script src="jarvis/js/bootstrap_datetimepicker.js"></script>


<script type="text/javascript">
  
  
  //add customer dialog
</script>



<link rel="stylesheet"
	href="jarvis/js/datatables/responsive/css/datatables.responsive.css">

<!-- Bootstrap Core CSS -->
<link href="jarvis/css1/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="jarvis/css1/sb-admin.css" rel="stylesheet">

<!-- Morris Charts CSS -->
<link href="jarvis/css1/plugins/morris.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="jarvis/css/font-icons/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">

<link rel="stylesheet"
	href="jarvis/css/font-icons/entypo/css/entypo.css">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->



</head>




<style>


#container {
    width:100%;
    text-align:center;
}

#left {
    float:left;
    width:100px;
}

#center {
    display: inline-block;
    margin:0 auto;
    width:100px;
}

#right {
    float:right;
    width:100px;
}

.panel {
	width: 75%;
}

#inner_panel {
	width: 100%;
}

.no-border {
	border: 0;
	box-shadow: none;
	/* You may want to include this as bootstrap applies these styles too */
}

.form-group.required .control-label:after {
	content: "*";
	color: red;
}

#abc {
	background-color: #F0F3F4;
	margin-top: 15px;
}

input[readonly] {
	background-color: white;
}

#xyz {
	height: 65px;
	text-align: center;
	background-color: #152F37;
}

#pqr {
	background-color: #152F37;
}

#date, #customer_detail, #grandtotal, #taxtotal, #subtotal {
	background-color: white;
}

.ui-dialog-titlebar {
	border: 0;
	padding: .5em 1em;
	background: black;
	overflow: auto;
	zoom: 1;
}
</style>
<script>

$(function () {
    $('#dtpicker').datetimepicker({
    	
    	format:'DD/MM/YYYY'
    	
    	
    })

    
});



</script>
<script>

	
var count=0;
var first_count=0;

var adv_counter=[];
var advid_counter={};
var acount=0;

var box_counter=[];
var tax_rate = [];
var tax_counter = [];
var tax_amount=[];
var tax_div=[];
var eorder = null;
var x=null;
var productList ;
var vendorList;
var taxList;
var myParam;


function setCookie(key, value, days) {
    var expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = key + '=' + value + ';expires=' + expires.toUTCString();
}
     

function getCookie(key) {
    var keyValue = document.cookie.match('(^|;) ?' + key + '=([^;]*)(;|$)');
    return keyValue ? keyValue[2] : null;
}

function loadName()
{
	var ccid = getCookie("CCID");
 	var sid = getCookie("SID");
 	var token = getCookie("TTID");
 	
 	
 	//get customer list

	$.ajax({
				type : 'POST',
				url : '/Accounting/rest/customer/getList?' + $.param({
					"cid" : ccid,
					"id" : sid,
					"token" : token
				}),
				dataType : "json",

				success : function(response, text, xhr) {

				
					customerList = JSON.parse(xhr.responseText);
					console.log(customerList);

					for (var i = 0; i < customerList.length; i++) {
						
						$('#customer_names').append("<option customerid='" +  customerList[i].id   + "' value='" + customerList[i].businessDetails.businessName +  "'>"  + "" + "</option>");
					}

					 
					 $('customer_names').append("<option value='+ Create Customer' id='add'>+ Create Customer</option>");

				},

				error : function(xhr, statusText) {

					console.log(xhr.status);
					console.log(xhr.responseText);
					var code = xhr.status;

				}
			});


 	 
 	 //get product list - all
 	 
 	 $.ajax({
 			   		type : 'POST',
 			   		url  : '/Accounting/rest/products/getAll?' + $.param({"cid" : ccid ,"id": sid,"token": token}),
 			    	dataType :'json',
 			    	success: function(response, text, xhr)
 			    	{
 			     		//console.log("products"    + JSON.parse(xhr.responseText));
 			     		productList = JSON.parse(xhr.responseText);
 			    
 			     		
 			        },
 					error: function (a,b,c)
 					{ 
 						
 					 	console.log(a.status);
 					}  
 			  });
 	   
 	  
 	 
 	 
 	 
 	 
 	 //get tax list
 	 
 	 
 	  $.ajax({
 			type : 'POST',
 			url  : '/Accounting/rest/tax/getAll?' + $.param({"cid" : ccid ,"id": sid,"token": token}) ,
 		    dataType : "json",

 			success: function(response, text, xhr) {
 				
 				
 				taxList = JSON.parse(xhr.responseText);
 			   console.log(taxList);
 				
 	},

 	error: function (xhr, statusText) {
 		
 	 
 	   console.log(xhr.status);
 	   console.log(xhr.responseText);
 	   var code = xhr.status;
 	   
 	   if(code == 404 || code == 514 || (code == 500 && response.indexOf("get") >=0 )|| (code == 500 && response.indexOf("invalid") >=0))  //cmp not found, invalid id, get failed
 			{
 	 		setCookie('errormsg',"Oops, something went wrong! Try again.",1);
 	 		window.location.replace("login.html");
 			}

 	 }

 	 });
 	 
 	 
 	 getEstimate();
 	   
}
 	
 	function getEstimate()
	{
 	
 		
 		var ccid = getCookie("CCID");
 	 	var sid = getCookie("SID");
 	 	var token = getCookie("TTID");
 		
		if(location.search == '')
    		alert("Invalid");
    	else
   		{
		 	myParam = location.search.split('EstimateNo=')[1];
	 
	 	
			$.ajax({
		   		type : 'POST',
		   		url  : '/Accounting/rest/estimate/getEstimate?' + $.param({ "eNo" : myParam , "cid" : ccid,
					"id" : sid,
					"token" : token }),
					
		    	dataType :'json',
		    	success: function(response, text , xhr) {
		     
		     eorder = JSON.parse(xhr.responseText);
		     fetchEstimate();
		     
		    },
			error: function (a,b,c)
			{ 
				alert(a.status+b+c);
				 console.log(a.status+b+c);
			}  
			  });
   }
	
	
}	


	
	
	/*populate contents of purchase order in form
	  if product/ tax deleted  -> show read only
	*/
	function fetchEstimate() {
		x = eorder;
		count = x.estimateDetails.length - 1;

		for (var i = 0; i < x.estimateDetails.length; i++) {
			
			box_counter.push(i);
			
			var prodString = '';
			var taxString = '';
			var prodDel = false;
			var taxDel = false;
			
			//if deleted, make input box readonly
			
			if(x.estimateDetails[i].product.deleted == true)
				{
					prodDel = true;
					prodString =  '<input class="form-control" list="' +  i  + 'productlist" id="' + i + 'product_name"  readonly   placeholder="Chose Product"  onchange="update_prod_details(' +  i+ ')"  required="required" title="" type="text" />';
				}
			else
				
					prodString =  '<input class="form-control" list="' +  i  + 'productlist" id="' + i + 'product_name"   placeholder="Chose Product"  onchange="update_prod_details(' +  i+ ')"  required="required" title="" type="text" />';
				
			if( x.estimateDetails[i].tax != null && x.estimateDetails[i].tax.deleted == true)
				{
					taxDel = true;
					taxString ='<input list="' + i + 'taxlist"  class="form-control" id="' +  i + 'tax_rate" readonly placeholder="Tax Rate" onchange="update_tax('+ i + ')">';
				}
		
			else
				taxString ='<input list="' + i + 'taxlist"  class="form-control" id="' +  i + 'tax_rate" placeholder="Tax Rate" onchange="update_tax('+ i + ')">';
								
				// add row with these input boxes to table
				
				$(
									'<tr >'
											+

											'<td>'
											+ '<div class="form-group required">'
											+ '<div class="col-md-12">'
											+ prodString
											+ '<datalist id="' +  i + 'productlist">' 
											+ '</datalist>' 
											+'</div>'
											+ '</div>'
											+ '</td>'
											+
											
											'<td>' 
											+ '<div class="form-group required">'
											+ '<div class="col-md-12">'
										    + '<input type="text"  class="form-control"' 
										    + 'id="' +  i + 'prod_desc" maxlength="30" name="proddesc"'
											+ 'placeholder="Description" required="required" title=""'
											+ '/>' 
											+'</div>' 
											+'</div>' 
											+'</td>' 
											+ 
											

											'<td>'
											+ '<div class="form-group required">'
											+ '<div class="col-md-12">'
											+ '<input type="number" value="1" class="form-control" id="'
											+ i
											+ 'quantity"  name="company_name" maxlength="30" name="username" placeholder="Quantity" required="required" title="" onchange="update_amount('
											+ i
											+ ')"  />'
											+ '</div>'
											+ '</div>'
											+ '</td>'
											+

											'<td>'
											+ '<div class="form-group required">'
											+ '<div class="col-md-12">'
											+ '<input type="number" value="0" class="form-control" id="'
											+ i
											+ 'price"  name="company_name" maxlength="30" name="username" placeholder="Price" required="required" title="" onchange="update_amount('
											+ i
											+ ')" />'
											+ '</div>'
											+ '</div>'
											+ '<br><br>'
											
											+ '<div class="form-group">'
											+ '<label class="col-md-4 control-label">Discount</label>'
											+ '<div class="col-md-8">'
											+ '<input type="number" value="0" class="form-control" id="' + 
											+ i 
											+ 'discount" placeholder="Discount"  onchange="update_amount('
											+ i
											+ ')"/>' 
											+ '</div>'
											+ '</div>'
											
											
											+ '<br><br>'
											+ '<div class="form-group required">'
											+ '<label class="col-md-3 control-label">Tax Rate</label>'
											+ '<div class="col-md-9">'
											+ taxString
											+ '<datalist id="'  +   i + 'taxlist">'
											
											+'</datalist>'
											+ '</div>'
											+ '</div>'
											+ '</td>'
											+ '<td>' 
											+ '<div class="form-group required">'
											+'<div class="col-md-12">'
											+ '<input class="form-control no-border" id="' +  i  +'amt" value="0"' + 
																 ' readonly style="background-color:white"' + 
																' title="" type="text" />'
											+ '</div>'
											+ '</div>'
											+

											'<br><br><br><br><br>'
											+ '<div class="form-group required">'
											+

											'<div class="col-md-12">'
											+ '<input class="form-control no-border" id="' + i + 'tax_amt" value="0"' + 
																   ' readonly style="background-color:white"' + 
																' title="" type="text" />'
											+ '</div>'
											+ '</div>'
											+'</td>'
											+'<td>'
											+ '<br>'
											+ '<i class="entypo-trash"'
											+ ' onClick="delete1(this,'
											+ i
											+ ')"></i>' 
											+ '</td>'
											+'</tr>').insertBefore('#last_row');
							
								
				//in corresponding dropdown, if product deleted  - populate with entire list else only with non deleted ones
							if(prodDel == false) 
								{
									for(var k=0;k<productList.length;k++)
							 		{
								
										if(productList[k].deleted == false)
											{
										    
											$('#' + i +'productlist').append("<option prodid='" +  productList[k].id   + "' value='" + productList[k].productName +  "'>" + "" +  productList[k].productDescription + "" + "</option>");
							 		}
								}
							}
								
							else
								{
									for(var k=0;k<productList.length;k++)
							 		{
										$('#' + i +'productlist').append("<option prodid='" +  productList[k].id   + "' value='" + productList[k].productName +  "'>" + "" +  productList[k].productDescription + "" + "</option>");
										$('#' + i + 'productlist').append("<option value='+ Add Product' id='add'>+ Add Product</option>");
							 		}
								}
							 
				//in corresponding dropdown, if tax deleted  - populate with entire list else only with non deleted ones	 
							if(taxDel == false)
						  	{
						     for(var n=0;n<taxList.length;n++)
						    	 {
						    	 	if(taxList[n].deleted == false)
						    	 		$('#' + i + 'taxlist').append("<option taxid='" +  taxList[n].id   + "' value='" + taxList[n].taxAbbreviation + " "  +  taxList[n].taxRate + "'>" + "</option>");
						    	 }
						  	}
							
							else
							{
								for(var n=0;n<taxList.length;n++)
						    	 {
									
						    	 		$('#' + i + 'taxlist').append("<option taxid='" +  taxList[n].id   + "' value='" + taxList[n].taxAbbreviation + " "  +  taxList[n].taxRate + "'>" + "</option>");
						    	 }
								
							}

			//now set values of tax and product
			
			$("#" + i + "product_name").val(x.estimateDetails[i].product.productName);
			
			//if item has no tax when created
			
			if(x.estimateDetails[i].tax !=null)
				$("#" + i + "tax_rate").val(x.estimateDetails[i].tax.taxAbbreviation + " " + x.estimateDetails[i].tax.taxRate);
			
			$("#" + i + "prod_desc").val(x.estimateDetails[i].description);
			$("#" + i + "quantity").val(x.estimateDetails[i].quantity);
			$("#" + i + "price").val(x.estimateDetails[i].price);
			$("#" + i + "discount").val(x.estimateDetails[i].discount);
			
			update_amount(i);
			
			var tax = $('#' + i + 'tax_rate').val();
			var tax_id = $('#' +  i + 'taxlist option[value="'+ tax +'"]').attr('taxid');
			
		}

		//$('#vendor_names option').find('id="58eb988c70587d44e415c913"').attr('selected','selected');
		//$("#vendor_names option[id='58eb988c70587d44e415c913']").attr( "selected","selected");
		
		$("#customer").val(x.customer.businessDetails.businessName);
		
		update_customer();
		
		$("#businessDetail").append("<h2>" + x.company.businessDetails.businessName   +  "</h2>");
		$("#businessDetail").append("<h4>" + x.company.contactDetails.addrLine1 + "  " +  x.company.contactDetails.addrLine2 + "  " + 
				x.company.contactDetails.locality + ", " +  x.company.contactDetails.state + ", "  +  x.company.contactDetails.city  + "</h4>");
		
		$("#estimate_number").val(x.estimateNumber);
		$("#estimate_number").prop('readonly',true);
		$('textarea#notes').val(x.estimateNotes);
		var d = new Date(x.estimateDate);
		var v = d.getDate() + "/" + (d.getMonth() + 1) + "/" + d.getFullYear();
		$("#date").val(v);


	}
	
	function update_customer()
	{
	var vdr = $("#customer").val();
		
		
		if(vdr =='+ Create Customer')
		{
		
			$("#customer").val('');
			$("#customer_detail").val('');
			
			$("#customer_dialog").dialog({
					modal : true,
					autoOpen : false,
					title : "Create Customer",
					resizable : false,
					width : 880,
					height : 760
				});

				$("#customer_dialog").dialog('open'); //clear all fields

			}

			else if(vdr != ''){

				var vendr_id = $('#customer_names option[value="' + vdr + '"]').attr('customerid');
				alert(vendr_id);
				for (var i = 0; i < customerList.length; i++) {
					
					if (customerList[i].id == vendr_id) {
						
						$("#customer_detail").val(customerList[i].contactDetails.addrLine1 + "  " +  customerList[i].contactDetails.addrLine2 + "  " + 
								customerList[i].contactDetails.locality + ", " +  customerList[i].contactDetails.state + ", "  +  customerList[i].contactDetails.city );

					}
				}

			}
		
			else if(vdr == '')
			{
				$("#customer").val('');
				$("#customer_detail").val('');
			
			}
		
		
		}

	function create_customer()
	{
		//ajax call, insert vendor, get ID /json back, add it to vendor list
		
		//check validation
		
		var bname = $('#business_name').val();
	    var cname = $('#contact_name').val();
	    var btype = $('#type_business').val();
	    var bsector = $('#business_sector').val();
	    
	    var addr1  = $('#addr_line1').val();
		var addr2  = $('#addr_line2').val();
	    var state  = $('#state').val();
	    var city  = $('#city').val();
	    var locality  = $('#locality').val();
	    var email  = $('#email').val();
	     var mobile  = $('#mobile').val();
	     var website = $('#website').val();
	     var code =$('#code').val();
	     var landline = $('#landline').val();
	     
	     var tin = $('#tin_no').val();
	     var cin =  $('#cin_no').val();
	     var strn = $('#strn_no').val();
	     var gst =  $('#gst_no').val();
	     var pan =  $('#pan_no').val();
	     
	     var acc_num = $('#account_num').val();
	     var type_account = $('#type_account').val();
	     var ifsc_code = $('#ifsc_code').val();   
	     var bank = $('#bank').val(); 
		
		//AJAX CALL
		
	   vendor_list.push(new_vendor);
		
	   $('#vendor_names').append("<option vendorid='" +  new_vendor[i].vendor_id   + "' value='" + vendor_list[i].vendor_name +  "'>"  + "" + "</option>");
	   	
		
		
		}
	
	
	var add_product_counter;

	

	/*when product chosen (means that product wasnt deleted), get its ID from dropdown -search ID in productList, 
	  populate price , desc from product, for tax : show only if tax associated with it isn't deleted
	  if product had no tax or if tax was deleted then make tax box  ''
	  if at all tax box was readonly earlier  - make it false and populate DD with non deleted taxes only
	
	*/
	function update_prod_details(counter) {

		var prod = $("#" + counter + "product_name").val();

		if (prod == '+ Add Product') {
			add_product_counter = counter; //to select this newly created product in ths box

			$("#" + counter + "product_name").val('');
			$("#" + counter + "tax_rate").val('');
			$("#" + counter + "prod_desc").val('');
			$("#" + counter + "quantity").val('');

			$("#product_dialog").dialog({

				modal : true,
				autoOpen : false,
				title : "Add Product",
				resizable : false,
				width : 1000,
				height : 700
			});

			$("#product_dialog").dialog('open'); //clear all fields

		}

		if (prod != '' && prod != '+ Add Product') {
			
		//collect product id from same dropdown - mention DD id

			var prod_id = $('#' + counter + 'productlist option[value="' + prod + '"]').attr(
					'prodid');
			
		
			
			for (var i = 0; i < productList.length; i++) {
				
				if (productList[i].id == prod_id) {
					
					
					/* 3 possibilities- (product has no tax or has tax which is deleted) - both cases tax = '' or has tax which is not deleted
					*  in any case, clear dropdown and load non deleted taxes
					* make read only as false
					*/
					
					$('#' + counter + 'taxlist').html('');
					$('#' + counter + 'tax_rate').attr('readonly',false);
					
					for(var n=0;n<taxList.length;n++)
			    	 {
			    	 	if(taxList[n].deleted == false)
			    	 		$('#' + counter + 'taxlist').append("<option taxid='" +  taxList[n].id   + "' value='" + taxList[n].taxAbbreviation + " "  +  taxList[n].taxRate + "'>" + "</option>");
			    	 }
					
					console.log(productList[i].productTax);
					//get price
					if (productList[i].productTax != null && productList[i].productTax.deleted == false) {
						
						
						var taxval = productList[i].productTax.taxAbbreviation + " "
								+ productList[i].productTax.taxRate;
					
						$("#" + counter + "tax_rate").val(taxval);
					}
					
					else if(productList[i].productTax != null && productList[i].productTax.deleted == true)
					{
						$("#" + counter + "tax_rate").val('');
					}
					
					else if(productList[i].productTax == null)
					{
						$("#" + counter + "tax_rate").val('');
					}

					$("#" + counter + "quantity").val(1);
					$("#" + counter + "discount").val(0);
					$("#" + counter + "price").val(productList[i].sellingPrice);
					$("#" + counter + "prod_desc").val(
							productList[i].productDescription);
					update_amount(counter);   //this handles case when product has no tax

				}
			}

		} else {
			//no product chosen, make tax rate read only = false, load non deleted products

			$("#" + counter + "price").val(0);
			$('#' + counter + 'taxlist').html('');
			$('#' + counter + 'tax_rate').attr('readonly',false);
			
			for(var n=0;n<taxList.length;n++)
	    	 {
	    	 	if(taxList[n].deleted == false)
	    	 		$('#' + counter + 'taxlist').append("<option taxid='" +  taxList[n].id   + "' value='" + taxList[n].taxAbbreviation + " "  +  taxList[n].taxRate + "'>" + "</option>");
	    	 }

			update_noproduct(counter);

			$("#" + counter + "tax_rate").val('');
			$("#" + counter + "prod_desc").val('');
			$("#" + counter + "discount").val('');
			$("#" + counter + "quantity").val(1);
		}

	}
	
</script>

<body onload="loadName()">


<!-- ADVANCE PAYMENT DIALOG -->


	<div id="advance_payment" title="Dialog Form" style="display: none;">
		<div id="form-panel">
			<form action="" method="post">

				<div class="form-group required">
					<label class="col-md-3 control-label">Customer Name</label>
					<div class="col-md-6">
						<input class="form-control" id="vendor_name" type="text"
							required value="" readonly/>
					</div>
				</div>

				<br> <br><br>

<!-- DATEPICKER TYPE -->
				<div class="form-group required">
																	<label class="col-md-3 control-label">Date</label>
																	<div class="col-md-6">
																		<div class="input-group date" id="dtpicker">

																			<input type="text" class="form-control" id="payment_date" onchange="get_duedate()">
																			<span class="input-group-addon"> <span
																				class="glyphicon glyphicon-calendar"> </span>
																			</span>
																		</div>
																	</div>
																</div>

			
				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Amount</label>
					<div class="col-md-6">
						<input class="form-control" id="adv_amount" type="number" step="any"
							required value="" onchange="tds_change()"/>
					</div>
				</div>
				
				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Purpose Title</label>
					<div class="col-md-9">
						<input class="form-control" id="purpose_title" type="text"
							required value="" />
					</div>
				</div>
				
				<br> <br>

				<div class="form-group ">
					<label class="col-md-3 control-label">Purpose Description</label>
					<div class="col-md-9">
						<input class="form-control" id="purpose_desc" type="text"
							value="" />
					</div>
				</div>
				
				<br><br>
				
				<div class="form-group required">
					<label class="col-md-3 control-label">Mode of Payment</label>
					<div class="col-md-6">
						<select class="form-control" id="mode_payment" required>
							<option value=''>Select</option>
							<option value="cash">Cash</option>
							<option value="card">Card</option>
							<option value="online">Online transfer</option>
							<option value="cheque">Cheque</option>
							
						</select>
					</div>
				</div>

				<br><br>
				
				<div class="form-group required">
					<label class="col-md-3 control-label">Payment Account</label>
					<div class="col-md-6">
						<select class="form-control" id="payment_acc" required>
							<option value=''>Select</option>
							<option value="cash">Cash</option>
							<option value="card">Card</option>
							<option value="online">Online transfer</option>
							<option value="cheque">Cheque</option>
							
						</select>
					</div>
				</div>
				
				<br><br>
				
				<!-- To deduct TDS., company TAN is required, check if TAN number given then show this -->
				
				
				<div class="form-group">
					<label class="col-md-3 control-label">TDS Rate(%)</label>
					<div class="col-md-6">
						<input class="form-control" id="tds_rate" type="number" step="any"
							 value=""  onchange="tds_change()"/>
					</div>
				</div>
				
				<br> <br>
				
				
				<div class="form-group ">
					<label class="col-md-3 control-label">TDS Amount</label>
					<div class="col-md-6">
						<input class="form-control" id="tds_amount" type="number" step="any"
							 value="" />
					</div>
				</div>
				
				

				<br> <br> <input id="advpay_submit" type="submit"
					value="Add payment" class="btn btn-blue" onclick="return make_advpay()">
			</form>
		</div>
	</div>


	<!-- END OF ADVANCE PAYMENT DIALOG -->
	
	<!-- EDIT PAYMENT DIALOG -->
	
	<div id="editnew_payment" title="Dialog Form" style="display: none;">
		<div id="form-panel">
			<form action="" method="post">

				<div class="form-group required">
					<label class="col-md-3 control-label">Vendor Name</label>
					<div class="col-md-6">
						<input class="form-control" id="newvendor_name" type="text"
							required value="" readonly/>
					</div>
				</div>

				<br> <br>

<!-- DATEPICKER TYPE -->
				<div class="form-group required">
					<label class="col-md-3 control-label">Date of Payment</label>
					<div class="col-md-6">
						<input class="form-control" id="newpayment_date" type="text" required
							value="" />
					</div>
				</div>

			
				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Amount</label>
					<div class="col-md-6">
						<input class="form-control" id="newadv_amount" type="number" step="any"
							required value="" onchange="edittds_change()"/>
					</div>
				</div>
				
				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Purpose Title</label>
					<div class="col-md-9">
						<input class="form-control" id="newpurpose_title" type="text"
							required value="" />
					</div>
				</div>
				
				<br> <br>

				<div class="form-group ">
					<label class="col-md-3 control-label">Purpose Description</label>
					<div class="col-md-9">
						<input class="form-control" id="newpurpose_desc" type="text"
							value="" />
					</div>
				</div>
				
				<br><br>
				
				<div class="form-group required">
					<label class="col-md-3 control-label">Mode of Payment</label>
					<div class="col-md-6">
						<select class="form-control" id="newmode_payment" required>
							<option value=''>Select</option>
							<option value="cash">Cash</option>
							<option value="card">Card</option>
							<option value="online">Online transfer</option>
							<option value="cheque">Cheque</option>
							
						</select>
					</div>
				</div>

				<br><br>
				
				<div class="form-group required">
					<label class="col-md-3 control-label">Payment Account</label>
					<div class="col-md-6">
						<select class="form-control" id="newpayment_acc" required>
							<option value=''>Select</option>
							<option value="cash">Cash</option>
							<option value="card">Card</option>
							<option value="online">Online transfer</option>
							<option value="cheque">Cheque</option>
							
						</select>
					</div>
				</div>
				
				<br><br>
				
				<!-- To deduct TDS., company TAN is required, check if TAN number given then show this -->
				
				
				<div class="form-group">
					<label class="col-md-3 control-label">TDS Rate(%)</label>
					<div class="col-md-6">
						<input class="form-control" id="newtds_rate" type="number" step="any"
							 value=""  onchange="edittds_change()"/>
					</div>
				</div>
				
				<br> <br>
				
				
				<div class="form-group ">
					<label class="col-md-3 control-label">TDS Amount</label>
					<div class="col-md-6">
						<input class="form-control" id="newtds_amount" type="number" step="any"
							 value="" />
					</div>
				</div>
				
				

				<br> <br> 
			</form>
			<input id="newadvpay_submit" type="submit"
					value="Save" class="btn btn-blue" onclick="return edit_advpay()">
		</div>
	</div>


	<!-- END OF EDIT PAYMENT DIALOG -->
	
	
	
	
	
		<!-- create product dialog-->
							
							
	<div id="product_dialog" title="Dialog Form" style="display: none;">
		<div id="form-panel">
			<form action="" method="post">
			
												<div class="form-group required">
													<label class="col-md-3 control-label">Product Name</label>
													<div class="col-md-6">
														<input class="form-control" id="product_name"
															name="product_name" maxlength="30"
															placeholder="Product Name" required="required" title=""
															type="text" />
													</div>
												</div>

												<br> <br> <br>

												<div class="form-group ">
													<label class="col-md-3 control-label">Product
														Description</label>
													<div class="col-md-6">
														<input class="form-control" id="product_desc"
															name="product_desc" maxlength="" title="" type="text" />
													</div>
												</div>

												<br> <br>

												

												<div class="form-group ">
													<label class="col-md-3 control-label">Category</label>
													<div class="col-md-6">
														<input class="form-control" id="category"
															name="category" maxlength="" title="" type="text" />
													</div>
												</div>

												<br> <br>

												<div class="form-group ">
													<label class="col-md-3 control-label">Cost Price</label>
													<div class="col-md-6">
														<input class="form-control" id="cp" name="cp"
															maxlength="" title="" type="text" />
													</div>
												</div>

												<br>
												<br>



												<div class="form-group required">
													<label class="col-md-3 control-label">Head of
														Expenditure</label>
													<div class="col-md-6">
														<select name="expenditure"
															class="form-control selectboxit" id="expenditure">
															<option value="None">Select</option>

															<option value="purchase">Purchases</option>

														</select>
													</div>
												</div>

												<br> <br>

												<div class="form-group ">
													<label class="col-md-3 control-label">Selling Price</label>
													<div class="col-md-6">
														<input class="form-control" id="sp" name="sp"
															maxlength="" title="" type="text" />
													</div>
												</div>

												<br>
												<br>


												<div class="form-group required">
													<label class="col-md-3 control-label">Head of
														Income</label>
													<div class="col-md-6">
														<select name="income" class="form-control selectboxit"
															id="income">
															<option value="None">Select</option>

															<option value="Sales">Sales</option>

														</select>
													</div>
												</div>

												<br> <br>
												
												<div class="form-group">
													<label class="col-md-3 control-label">Discount</label>
													<div class="col-md-6">
														<input class="form-control" id="discount" name="discount"
															maxlength="" title="" type="text" />
													</div>
												</div>
												
												<br><br>

												

												<div class="form-group required">
											<label class="col-md-3 control-label">Tax Rate</label>
											<div class="col-md-6">

												<input list="prodtaxlist" class="form-control"
													id="prodtax_rate" placeholder="Tax Rate">

												<datalist id="prodtaxlist">


												</datalist>
											</div>
										</div>

												<br> <br>


											</form>
											<input type="submit" class="btn btn-primary"
												 onclick="return add_product()">




										</div>
									</div>
			<!-- end of create product dialog -->
	
	
<!-- CREATE VENDOR DIALOG -->

<div id="vendor_dialog" title="Dialog Form" style="display: none;">
		<div id="form-panel">
		
		
		<!------CONTROL TABS START------>
						<ul class="nav nav-tabs bordered">
							<li class="active"><a href="#business" data-toggle="tab"><i
									class="entypo-menu"></i> Business Details </a></li>
							<li><a href="#contact" data-toggle="tab"><i
									class="entypo-menu"></i> Contact Details </a></li>
							<li><a href="#tax" data-toggle="tab"><i
									class="entypo-menu"></i>  Tax Details </a></li>
							<li><a href="#account" data-toggle="tab"><i
									class="entypo-menu"></i> Account Details </a></li>

						</ul>
						<!------CONTROL TABS END------>
						
						
							
						<!--  Control tab features -->

						<div class="tab-content">
							<!----    BUSINESS-->
							<div class="tab-pane box active" id="business">
								<br>
								
								
			<form action="" method="post">

				<div class="form-group required">
					<label class="col-md-3 control-label">Business Name</label>
					<div class="col-md-6">
						<input class="form-control" id="business_name" type="text"
							required value="" />
					</div>
				</div>

				<br> <br><br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Contact Person Name</label>
					<div class="col-md-6">
						<input class="form-control" id="contact_name" type="text" required
							value="" />
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Type of Business</label>
					<div class="col-md-6">
						<select class="form-control" id="type_business" required>
							<option value=''>Select</option>
							<option value="Propreitorship">Propreitorship</option>
							<option value="Partnership">Partnership</option>
							<option value="Limited Liability Partnership">Limited
								Liability Partnership</option>
							<option value="One Person Company">One Person Company</option>
							<option value="Private Limited Company">Private Limited
								Company</option>
							<option value="Limited Company">Limited Company</option>
						</select>
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Business Sector</label>
					<div class="col-md-6">
						<input class="form-control" id="business_sector" type="text"
							required value="" />
					</div>
				</div>
				
				<br><br>
				<div class="form-group required">
				<div class="col-md-6">
				<input id="business" type="submit"
					value="Save" class="btn btn-blue" 
					onclick="return save_business()"> 
					</div>
					</div>
				</form>
				
								<br><br><br>
								
								
								
								</div> <!-- end of vendor dialog -->
								
								
								
								
								
							<div class="tab-pane box " id="contact">
								<br>
								
								
			<form action="" method="post">

				<div class="form-group required">
					<label class="col-md-3 control-label">Address Line 1</label>
					<div class="col-md-6">
						<input class="form-control" id="addr_line1" type="text"
							required="required" />
					</div>
				</div>

				<br> <br><br>

				<div class="form-group ">
					<label class="col-md-3 control-label">Address Line 2</label>
					<div class="col-md-6">
						<input class="form-control" id="addr_line2" type="text" />
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">State</label>
					<div class="col-md-6">
						<select class="form-control" id="state" required="required">
								<option value="New Delhi">New Delhi</option>
							<option value="Andaman/Nicobar Islands">Andaman/Nicobar Islands</option>
							<option value="Andhra Pradesh">Andhra Pradesh</option>
							<option value="Arunachal Pradesh">Arunachal Pradesh</option>
							<option value="Assam">Assam</option>
							<option value="Bihar">Bihar</option>
							<option value="Chandigarh">Chandigarh</option>
							<option value="Dadra/Nagar Haveli">Dadra/Nagar Haveli</option>
							<option value="Daman/Diu">Daman/Diu</option>
							<option value="Goa">Bihar</option>
							<option value="Gujarat">Gujarat</option>
							<option value="Haryana">Haryana</option>
							<option value="Himachal Pradesh">Himachal Pradesh</option>
							<option value="Jammu/Kashmir">Jammu/Kashmir</option>
							<option value="Jharkhand">Jharkhand</option>
							<option value="Karnataka">Karnataka</option>
							<option value="Kerala">Kerala</option>
							<option value="Lakshadweep">Lakshadweep</option>
							<option value="Madhya Pradesh">Madhya Pradesh</option>
							<option value="Maharashtra">Maharashtra</option>
							
							<option value="Manipur">Manipur</option>
							<option value="Meghalaya">Meghalaya</option>
							<option value="Mizoram">Mizoram</option>
							<option value="Nagaland">Nagaland</option>
							<option value="Orissa">Orissa</option>
							<option value="Pondicherry">Pondicherry</option>
							<option value="Punjab">Punjab</option>
							<option value="Rajasthan">Rajasthan</option>
							<option value="Sikkim">Sikkim</option>
							<option value="Tamil Nadu">Tamil Nadu</option>
							<option value="Telangana">Telangana</option>
							<option value="Tripura">Tripura</option>
							<option value="Uttaranchal">Uttaranchal</option>
							<option value="Uttar Pradesh">Uttar Pradesh</option>
							<option value="West Bengal">West Bengal</option>
						</select>
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">City</label>
					<div class="col-md-6">
						<input class="form-control" id="city" type="text"
						 required="required" />
							
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Locality</label>
					<div class="col-md-6">
						<input class="form-control" id="locality" type="text"
							placeholder="Prominent Landmark" required="required" />
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Email</label>
					<div class="col-md-6">
						<input class="form-control" id="email" name="email" maxlength="30"
							required="required" title="" type="email" />
					</div>
				</div>

				<br> <br>

				<div class="form-group">
					<label class="col-md-3 control-label">Website</label>
					<div class="col-md-6">
						<input class="form-control" id="website" name="website"
							maxlength="30" title="" type="email" />
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Mobile No</label>
					<div class="col-md-1">+91</div>
					<div class="col-md-5">
						<input class="form-control" id="mobile" name="mobile"
							required="required" title="" type="number"
							oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
							type="number" maxlength="10" />
					</div>
				</div>



				<br> <br>
				<div class="form-group ">
					<label class="col-md-3 control-label">Landline No</label>
					<div class="col-md-1">+91</div>
					<div class="col-md-2">
						<input class="form-control" id="code" name="code"
							placeholder="STD Code" title="" type="number"
							oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
							maxlength="3" />&nbsp;
					</div>
					<div class="col-md-3">
						<input class="form-control" id="landline" name="landline"
							placeholder="Landline number" title="" type="number"
							oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
							maxlength="8" />

					</div>

				</div>

				<br> <br>
				
				<div class="form-group required">
				<div class="col-md-6">
				 <input id="contact" type="submit"
					value="Save" class="btn btn-blue" 
					onclick="return save_contact()"> 

					</div>
					</div>

			</form>
				
								<br><br><br>
								
								
								</div> <!-- end of contact -->
								
								
								
								
								<!-- tax details -->
								
								<div class="tab-pane box " id="tax">
								<br>
								
								
								<form action="" method="post">





				<div class="form-group required">
					<label class="col-md-3 control-label">Company PAN No</label>
					<div class="col-md-6">
						<input class="form-control" id="pan_no" name="pan_no"
							maxlength="10" required="required" title="" type="text" />
					</div>
				</div>

				<br>
				<br><br>

				<div class="form-group ">
					<label class="col-md-3 control-label"> TIN No</label>
					<div class="col-md-6">
						<input class="form-control" id="tin_no" name="tin_no" title=""
							oninput="javascript: if (this.value.length > this.maxLength) this.value = this.value.slice(0, this.maxLength);"
							type="number" maxlength="11" />
					</div>
				</div>
				
				
					<br>
				<br>

				<div class="form-group">
					<label class="col-md-3 control-label">Service Tax Registration No</label>
					<div class="col-md-6">
						<input class="form-control" id="strn_no" name="cin_no"
							maxlength="21" title="" type="text" />
					</div>
				</div>
				

				<br>
				<br>
				
				
				<div class="form-group">
					<label class="col-md-3 control-label">GST No</label>
					<div class="col-md-6">
						<input class="form-control" id="gst_no" name="cin_no"
							maxlength="21" title="" type="text" />
					</div>
				</div>
				

					<br>
				<br>


				<div class="form-group">
					<label class="col-md-3 control-label">Company CIN No</label>
					<div class="col-md-6">
						<input class="form-control" id="cin_no" name="cin_no"
							maxlength="21" title="" type="text" />
					</div>
				</div>
				
			

				<br> <br> 
				
				<div class="form-group required">
				<div class="col-md-6">
				 <input id="taxdetails" type="submit"
					value="Save" class="btn btn-blue" 
					onclick="return save_tax()"> 
					</div>
					</div>
				
				
			</form>
								<br><br><br>
								
								
								</div>
								
					<!-- end of tax -->			
								
								
								
								<div class="tab-pane box " id="account">
								<br>
								
								
								<form action="" method="post">

				<div class="form-group required">
					<label class="col-md-3 control-label">Account Number</label>
					<div class="col-md-6">
						<input class="form-control" id="account_num" type="number" />
					</div>
				</div>

				<br> <br><br>

				<div class="form-group required">
					<label class="col-md-3 control-label">Type of Account</label>
					<div class="col-md-6">
						<select class="form-control" id="type_account">
							<option value="Savings">Savings</option>
							<option value="Overdraft">Overdraft</option>
							<option value="Current Account">Current Account</option>
						</select>
					</div>
				</div>

				<br> <br>




				<div class="form-group required">
					<label class="col-md-3 control-label">Bank</label>
					<div class="col-md-6">
						<select class="form-control" id="bank">
							<option value="Proprietorship">Proprietorship</option>
							<option value="Partnership">Partnership</option>
							<option value="Limited Liability Partnership">Limited
								Liability Partnership</option>
							<option value="One Person Company">One Person Company</option>
							<option value="Private Limited Company">Private Limited
								Company</option>
							<option value="Limited Company">Limited Company</option>
						</select>
					</div>
				</div>

				<br> <br>

				<div class="form-group required">
					<label class="col-md-3 control-label">IFSC Code</label>
					<div class="col-md-6">
						<input class="form-control" id="ifsc_code" type="text"
							maxlength="30" />
					</div>
				</div>

				<br> <br> 
				
				<div class="form-group required">
				<div class="col-md-6">
				 <input id="account" type="submit"
					value="Save" class="btn btn-blue" 
					onclick="return save_account()"> 
					</div>
					</div>
					
			</form>
								<br><br><br>
								
								
								</div>
								<!-- end of account -->
								
								
								
								</div> <!-- end of tab content -->
		
		
		</div>
		</div>
	
	


	<div id="wrapper">

		<!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"
			id="pqr">
			<!-- Brand and toggle get grouped for better mobile display -->
			<div class="navbar-header" id="xyz">
				<button type="button" class="navbar-toggle" data-toggle="collapse"
					data-target=".navbar-ex1-collapse">
					<span class="sr-only">Toggle navigation</span> <span
						class="icon-bar"></span> <span class="icon-bar"></span> <span
						class="icon-bar"></span>
				</button>

				<a class="navbar-brand" href="index.html" id="xyz" style="color:white;font-size:30px">SIMPLIFY TAX</a>
				<a class="navbar-brand" id="xyz" class="company_name"
					style="font-size: 30px"></a>


			</div>
			<!-- Top Menu Items -->
			<ul class="nav navbar-right top-nav" id="pqr">
				
				<li><a href="#" style="color:white"><i class="entypo-plus"></i></a></li>
				
				<li class="dropdown"><a href="#" class="dropdown-toggle"
					data-toggle="dropdown" style="color:white"><i class="fa fa-bell"></i> <b
						class="caret"></b></a>
					<ul class="dropdown-menu alert-dropdown">
						<li><a href="#">Alert Name <span
								class="label label-default">Alert Badge</span></a></li>
						<li><a href="#">Alert Name <span
								class="label label-primary">Alert Badge</span></a></li>
						<li><a href="#">Alert Name <span
								class="label label-success">Alert Badge</span></a></li>
						<li><a href="#">Alert Name <span class="label label-info">Alert
									Badge</span></a></li>
						<li><a href="#">Alert Name <span
								class="label label-warning">Alert Badge</span></a></li>
						<li><a href="#">Alert Name <span
								class="label label-danger">Alert Badge</span></a></li>
						<li class="divider"></li>
						<li><a href="#">View All</a></li>
					</ul></li>
					
				<li class="dropdown"><a class="dropdown-toggle"
					data-toggle="dropdown" style="color:white"><i class="fa fa-fw fa-gear"></i>Settings</a>
					<ul class="dropdown-menu">
						<li><a href="tax_settings.html" > Tax Settings</a></li>
						<li class="divider"></li>
						<li><a href="financial_settings.html">Financial Settings </a></li>
						<li class="divider"></li>
						<li><a href="products.html">Products </a></li>
					</ul>
				</li>


				<li class="dropdown"><a href="#" class="dropdown-toggle"
					data-toggle="dropdown" style="color:white">&nbsp;<i class="fa fa-user" id="name"></i>
						<b class="caret"></b></a>
					<ul class="dropdown-menu">
						<li><a href="company_profile.html"><i
								class="fa fa-fw fa-user"></i> Profile</a></li>


						<li class="divider"></li>
						<li><a href="logout.html"><i
								class="fa fa-fw fa-power-off"></i> Log Out</a></li>
					</ul></li>
			</ul>

			<!-- Sidebar Menu Items - These collapse to the responsive navigation menu on small screens -->
			<div class="collapse navbar-collapse navbar-ex1-collapse">
				<ul class="nav navbar-nav side-nav" id="abc">

					<li ><a href="index.html"><i
							class="fa fa-fw fa-dashboard"></i> Home</a></li>
							
					<li class="active"><a href="PurchaseOrders.html"><i class="fa fa-fw fa-dashboard"></i>
							Purchase Orders</a></li>
							
					<li><a href="Bills.html"><i class="fa fa-fw fa-dashboard"></i>
							Bills</a></li>
							
					<li><a href="Invoice.html"><i
							class="fa fa-fw fa-dashboard"></i> Estimate</a></li>
					
					<li><a href="Estimate.html"><i
							class="fa fa-fw fa-dashboard"></i> Invoice</a></li>
					
					<li><a href="Receipts.html"><i
							class="fa fa-fw fa-dashboard"></i> Receipts</a></li>
							
					<li><a href="Reports.html"><i
							class="fa fa-fw fa-dashboard"></i> Reports</a></li>
							
					<li><a href="Customers.html"><i
							class="fa fa-fw fa-dashboard"></i> Customers</a></li>
							
					<li><a href="Vendors.html"><i
							class="fa fa-fw fa-dashboard"></i> Vendors</a></li>
				
					
					
				</ul>
			</div>
			<!-- /.navbar-collapse -->
		</nav>


		<div id="page-wrapper">

			<div class="container-fluid">


				<h1 class="page-header">Edit Estimate</h1>
				<!-- Row beginning -->
				<div class="row" id="row">
					<div class="col-lg-12">

							

								<div class="panel panel-default">
									<div class="row">
										<div class="col-lg-12">
											<button type="button" class="btn btn-info"
												style=" width: 100%" data-toggle="collapse"
												
												data-target="#portionOne">Business Details</button>
												
											<div id="businessDetail" class="panel-collapse collapse in">
											
											</div>
											<!-- end of portion one -->

										</div>
										<!-- end of row1 -->
									</div>
								</div>

								<br>






								<div class="panel panel-default">
									<button type="button" class="btn btn-info"
										style=" width: 100%">Customer Details</button>
									<div class="row">
										<!-- ROW 2 -->
										<div class="col-lg-12">
											<!-- How wide table should be -->


											<!-- make another row for customer details -->
											<div class="panel panel-default" id="inner_panel">
												<div class="row">
													<div class="col-lg-12">


<div id="form-panel">
															<form role="form" id="customer_profile">

							<div class="form-group required">
																	<label class="col-md-2 control-label">Customer</label>
																	<div class="col-md-4">
																		<input list="customer_names" class="form-control"
																			id="customer" placeholder=" Chose Customer"
																			onchange="update_customer()">

																		<!-- upon selection, show all customer details in txtarea, right panel needs purchase order number, date
                                  store customer id save this -->

																		<datalist id="customer_names">
																			
																			
																		</datalist>


																	</div>
																</div>




																<br> <br>

																<div class="form-group ">

																	<div class="col-md-6">
																		<textarea class="form-control" id="customer_detail"
																			rows="5" cols="80" readonly></textarea>
																	</div>
																</div>

																

																
																<br> <br>

																<div class="form-group required">
																	<label class="col-md-2 control-label">Estimate Number</label>
																	<div class="col-md-4">
																		<input class="form-control" id="estimate_number"
																			maxlength="100" required="required" title=""
																			type="text" />
																	</div>
																</div>

																<br> <br>


																
																<div class="form-group required">
																	<label class="col-md-2 control-label">Date</label>
																	<div class="col-md-4">
																		<div class="input-group date" id="dtpicker">

																			<input type="text" class="form-control" id="date" >
																			<span class="input-group-addon"> <span
																				class="glyphicon glyphicon-calendar"> </span>
																			</span>
																		</div>
																	</div>
																</div>
																<br> <br>



															</form>
														</div>
														<!-- form panel -->

													</div>
												</div>

												<br> <br>
										


											<table class="table borderless datatable" id="table_export">
												<thead>
													<tr>

														<th><div>Product</div></th>
														<th><div>Description</div></th>
														<th><div>Quantity</div></th>
														<th><div>Price</div></th>

														<th><div>Amount</div></th>
														<th><div></div></th>
													</tr>
												</thead>
												<tbody>
												<tr id="last_row" class="middle">
														<td colspan="5" id="add_row"><i
															class="entypo-plus-circled"></i>Add new item</td>
													</tr>

													<tr>
														<td colspan="5" class="right">
															<div class="form-group ">
																<label class="col-md-2 control-label">SubTotal</label>
																<div class="col-md-3">
																	<input type="number" value="0"
																		class="form-control no-border" readonly id="subtotal"
																		 maxlength="30" name="subtotal"
																		placeholder="SubTotal" required="required" title=""
																		 />
																</div>
															</div>

														</td>
													</tr>

													<tr id="taxfinalamt">
														<td colspan="5" class="right">
															<div class="form-group ">
																<label class="col-md-2 control-label">Tax Amount</label>
																<div class="col-md-3">
																	<input type="number" value="0"
																		class="form-control no-border" readonly id="taxtotal"
																		name="taxtotal" maxlength="30" 
																		placeholder="TaxTotal" required="required" title=""
																		 />
																</div>
															</div>

														</td>
													</tr>


													<tr id="gtotal">
														<td colspan="5" class="right">
															<div class="form-group ">
																<label class="col-md-2 control-label">Grand
																	Total</label>
																<div class="col-md-3">
																	<input type="number" value="0"
																		class="form-control no-border" readonly
																		id="grandtotal"  maxlength="30"
																		name="grandtotal" placeholder="GrandTotal"
																		required="required" title=""
																		 />
																</div>
															</div>

														</td>
													</tr>
												
													
													
												</tbody>
											</table>



														

										</div>



									</div>
									<!-- /.row -->
									
									
									
									<br>
									
									
					                    
					                    
					                    
					                    <!-- new row for notes -->
									
									
									<div class="row">
									<div class="col-lg-12">
									<form>
									<div class=form-group>
									<label class="col-md-1 control-label">Notes</label>
									<br>
									<div  class="col-md-6">
															<textarea class="form-control" id="notes" rows="10"
																cols="10"></textarea>
																</div>
								    </div>
								    </form>
																
								</div>
								</div>
									<!-- end of notes -->
					                    
					                    
									
								</div>
								<!-- closure for Main panel -->

								<br><br>

								
								<!-- Another row -->
								<div class="row">
									<div class="col-lg-6">
										<input type="submit" class="btn btn-blue" name="submit"
											id="submit" value="Save and Continue">
										&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

										<!-- create another row -->
									</div>
								</div>

<br><br>
							</div>
							<!-- one tab listing feature ends-->

							<!-- New Nav bar feature listing(create bill) -->

							





						</div>
						<!-- nav content -->






					</div>
					<!--  wrapper -->



				</div>
				<!-- /.container-fluid -->

			</div>
			<!-- /#page-wrapper -->

		</div>
		<!-- /#wrapper -->
</body>





<script>
                          
                           

$(function() { 
	$("#add_row").click(function() {            //dynamically add a row for item entry

						count = count + 1;
						box_counter.push(count);
						
						$(
								'<tr >'
										+

										'<td>'
										+ '<div class="form-group required">'
										+ '<div class="col-md-12">'
										+ '<input class="form-control" list="' +  count  + 'productlist" id="' + count + 'product_name"  name="company_name"   placeholder="Chose Product"  onchange="update_prod_details(' +   count + ')"  required="required" title="" type="text" />'
										+ '<datalist id="' +  count + 'productlist">' 
										+ '</datalist>' 
										+'</div>'
										+ '</div>'
										+ '</td>'
										+
										
										'<td>' 
										+ '<div class="form-group required">'
										+ '<div class="col-md-12">'
									    + '<input type="text"  class="form-control"' 
									    + 'id="' +  count + 'prod_desc" maxlength="30" name="proddesc"'
										+ 'placeholder="Description" required="required" title=""'
										+ '/>' 
										+'</div>' 
										+'</div>' 
										+'</td>' 
										+ 
										

										'<td>'
										+ '<div class="form-group required">'
										+ '<div class="col-md-12">'
										+ '<input type="number" value="1" class="form-control" id="'
										+ count
										+ 'quantity"  maxlength="30" name="username" placeholder="Quantity" required="required" title="" onchange="update_amount('
										+ count
										+ ')"  />'
										+ '</div>'
										+ '</div>'
										+ '</td>'
										+

										'<td>'
										+ '<div class="form-group required">'
										+ '<div class="col-md-12">'
										+ '<input type="number" value="0" class="form-control" id="'
										+ count
										+ 'price"  name="company_name" maxlength="30" name="username" placeholder="Price" required="required" title="" onchange="update_amount('
										+ count
										+ ')" />'
										+ '</div>'
										+ '</div>'
										+ '<br><br>'
										
										+ '<div class="form-group">'
										+ '<label class="col-md-4 control-label">Discount</label>'
										+ '<div class="col-md-8">'
										+ '<input type="number" value="0" class="form-control" id="' + 
										+ count 
										+ 'discount" placeholder="Discount"  onchange="update_amount('
										+ count
										+ ')"/>' 
										+ '</div>'
										+ '</div>'
										
										+ '<br><br>'
										+ '<div class="form-group required">'
										+ '<label class="col-md-3 control-label">Tax Rate</label>'
										+ '<div class="col-md-9">'
										+ '<input list="' + count + 'taxlist"  class="form-control" id="'
										+ count
										+ 'tax_rate" placeholder="Tax Rate" onchange="update_tax('
										+ count
										+ ')">'
										+ '<datalist id="'  +    count + 'taxlist">'
										
										+'</datalist>'
										+ '</div>'
										+ '</div>'
										+ '</td>'
										+ '<td>' 
										+ '<div class="form-group required">'
										+'<div class="col-md-12">'
										+ '<input class="form-control no-border" id="' +  count  +'amt" value="0"' + 
															 ' readonly style="background-color:white"' + 
															' title="" type="text" />'
										+ '</div>'
										+ '</div>'
										+

										'<br><br><br><br><br>'
										+ '<div class="form-group required">'
										+

										'<div class="col-md-12">'
										+ '<input class="form-control no-border" id="' + count + 'tax_amt" value="0"' + 
															   ' readonly style="background-color:white"' + 
															' title="" type="text" />'
										+ '</div>'
										+ '</div>'
										+'</td>'
										+'<td>'
										+ '<br>'
										+ '<i class="entypo-trash"'
										+ ' onClick="delete1(this,'
										+ count
										+ ')"></i>' 
										+ '</td>'
										+'</tr>').insertBefore('#last_row');
						
						
						
						for(var i=0;i<productList.length;i++)
						 {
						
						 //show only inventory, noninv and service input type products
						  if(productList[i].deleted == false)
					        		$('#' + count +'productlist').append("<option prodid='" +  productList[i].id   + "' value='" +productList[i].productName +  "'>" + "" +  productList[i].productDescription + "" + "</option>");
						 
						 }
					 
						$('#' + count + 'productlist').append("<option value='+ Add Product' id='add'>+ Add Product</option>");
					  
					     for(var i=0;i<taxList.length;i++)
					    	 {
					    	   if(taxList[i].deleted == false)
					    	 		$('#' + count + 'taxlist').append("<option taxid='" +  taxList[i].id   + "' value='" + taxList[i].taxAbbreviation + " "  +  taxList[i].taxRate + "'>" + "</option>");
					    	 }

					});

});
                       
                           
                          
                           function update_amount(value_counter) {
                       		
                   			var existing_taxamt = $('#' + value_counter + 'tax_amt').val();
                   			var current_amount = $('#' + value_counter + 'amt').val();
                   		
                   			//update subtotal

                   			if (current_amount != 0)                                           //subtract initial value from sub total and grand total 
                   			{
                   				var subamt = Number($('#subtotal').val()) - current_amount;
                   				$('#subtotal').val(subamt.toFixed(2));
                   				var finalamt = Number($('#grandtotal').val()) - current_amount;
                   				$('#grandtotal').val(finalamt.toFixed(2));

                   			}

                   		        // update newly calculated amount (price *quantity)

                   			var qty = value_counter + 'quantity';
		    var newPrice = (Number($('#' + value_counter + 'price').val()) - Number($("#" +  value_counter + "discount").val())).toFixed(2);
			var new_amount = ($('#' + qty).val() * newPrice);   
			$('#' + value_counter + 'amt').val(new_amount.toFixed(2));

                   		         // update subtotal and grand total

                   			var subtotalamt = Number($('#subtotal').val()) + new_amount;
                   			$('#subtotal').val(subtotalamt.toFixed(2));
                   			var finalamt = Number($('#grandtotal').val()) + new_amount;
                   			$('#grandtotal').val(finalamt.toFixed(2));

                   		         // Update corresponding tax amount, tax total and grand total

                   			var tax_input = $('#' + value_counter + 'tax_rate').val();                        //value of input box (vat 5.5)

                   			if (tax_input != '')                                                              //if a tax type exists
                   			{
                   				var rate = tax_input.toString().split(" ");                                   // parse tax type get the rate(5.5)
                                   var newtaxamt = (rate[1] / 100) * ($('#' + value_counter + 'amt').val());
                   				$('#' + value_counter + 'tax_amt').val(newtaxamt.toFixed(2));
                   				var taxtotal = Number($('#taxtotal').val()) - Number(existing_taxamt) + Number(newtaxamt.toFixed(2));
                   				$('#taxtotal').val(taxtotal.toFixed(2));
                   				var finalamt = Number($('#grandtotal').val()) - Number(existing_taxamt)+ Number(newtaxamt.toFixed(2));
                   				$('#grandtotal').val(finalamt.toFixed(2));
                   				tax_addition(tax_input, value_counter, newtaxamt.toFixed(2));                         //call func to handle tax slab div       

                   		}
                   			else    //if product changes, and it has no tax but had tax earlier - handle it to remove earlier chngs
            				{
            				update_tax(value_counter);
            				}
                   	}

                   	
                   	function update_noproduct(value_counter) {
                   		
                   		var existing_taxamt = $('#' + value_counter + 'tax_amt').val();
                   		var current_amount = $('#' + value_counter + 'amt').val();
                   	
                   		//update subtotal

                   		if (current_amount != 0)                                           //subtract initial value from sub total and grand total 
                   		{
                   			var subamt = Number($('#subtotal').val()) - current_amount;
                   			$('#subtotal').val(subamt.toFixed(2));
                   			var finalamt = Number($('#grandtotal').val()) - current_amount;
                   			$('#grandtotal').val(finalamt.toFixed(2));

                   		}

                   	        // update newly calculated amount (price *quantity)

                   		var qty = value_counter + 'quantity';
                   		var new_amount = ($('#' + qty).val() * $('#' + value_counter + 'price').val());   
                   		$('#' + value_counter + 'amt').val(new_amount.toFixed(2));

                   	         // update subtotal and grand total

                   		var subtotalamt = Number($('#subtotal').val()) + new_amount;
                   		$('#subtotal').val(subtotalamt.toFixed(2));
                   		var finalamt = Number($('#grandtotal').val()) + new_amount;
                   		$('#grandtotal').val(finalamt.toFixed(2));

                   	         // Update corresponding tax amount, tax total and grand total

                   		
                   		
                   		
                   		var tax_input = $('#' + value_counter + 'tax_rate').val();                        //value of input box (vat 5.5)
                   		
                   		

                   		if (tax_input != '')                                                              //if a tax type exists
                   		{
                   			var rate = tax_input.toString().split(" ");                                   // parse tax type get the rate(5.5)
                               var newtaxamt = (rate[1] / 100) * ($('#' + value_counter + 'amt').val());
                   			$('#' + value_counter + 'tax_amt').val(newtaxamt.toFixed(2));
                   			var taxtotal = Number($('#taxtotal').val()) - Number(existing_taxamt) + Number(newtaxamt.toFixed(2));
                   			$('#taxtotal').val(taxtotal.toFixed(2));
                   			var finalamt = Number($('#grandtotal').val()) - Number(existing_taxamt)+ Number(newtaxamt.toFixed(2));
                   			$('#grandtotal').val(finalamt.toFixed(2));
                   			tax_addition_exclusive(tax_input, value_counter, newtaxamt.toFixed(2));                         //call func to handle tax slab div       

                   	}
                   }
                   	
                   	
                   	
                   	function tax_addition_exclusive(tax_val, number_count, tax_amt)
                   	{
                   		var nd = tax_val.toString().split(" ");                      //VAT 5.5
                       	var x = nd[1].toString().split(".");                         //5 5
                       	var n = nd[0] + x[0] + x[1];                                 //VAT55
                   		var intval = n;                                              //tax slab div ID prefix
                   		
                              //check if value_counter had contributed to any tax earlier - nullify its effects 

                          var counter_index = tax_counter.indexOf(number_count);
                         
                                  //  alert("entry for this box exists at index" + counter_index);
                                    var divid  = tax_div[counter_index];
                                    //alert("div id is " + divid);
                                    var amt   = tax_amount[counter_index];  //old amt
                                    //alert("old amount is " + amt);
                                    //alert("b4 subtraction amt is" + $('#' + divid).val());
                                    var subtract_amt = Number($('#' + divid).val()) - Number(amt);  //now that its changing, take amt subtract from div
                                    //alert("after subtraction amt is"  + subtract_amt);

                   			     if(subtract_amt==0)
                   			     {
                   			       //remove table row
                   			       $('#' + divid).closest('tr').remove();
                   			       tax_rate[counter_index]=-1;
                   			            
                   			     } 
                   			     
                   			     else
                   			         $('#' + divid).val(subtract_amt.toFixed(2));  
                   			     
                   			     
                   			     tax_div[counter_index] =-1;
                   			        tax_amount[counter_index] = 0;
                   			        tax_rate[counter_index] =-1;
                   		
                   		
                   		
                   	}
                   	
                   	
                   	
                   	
                   	
                   	function update_tax(value_counter)                                        // tax type - dropdown chosen
                   	{

                   		var tax_value = $("#" + value_counter + "tax_rate").val();            //VAT 5.5
                   		if(tax_value!='')
                   		{
                   		var existing_taxamt = $('#' + value_counter + 'tax_amt').val();
                   		var amt = value_counter + 'amt';  
                   		var taxamt = value_counter + 'tax_amt';
                        	var tax_bracket = tax_value.toString().split(" ");                   //5.5
                        	var taxrate = tax_bracket[1];
                        	var newtaxamt = (taxrate/100)*($('#' + amt).val());
                        	
                        	
                        	
                        	$('#' + taxamt).val(newtaxamt.toFixed(2));                              //update corresponding tax amt
                        	var taxtotal =  Number($('#taxtotal').val()) - existing_taxamt + Number(newtaxamt.toFixed(2));     //update txtotal
                           $('#taxtotal').val(taxtotal.toFixed(2));
                              
                              
                           var finalamt =  Number($('#grandtotal').val()) - existing_taxamt + Number(newtaxamt.toFixed(2));    //update grand total
                           $('#grandtotal').val(finalamt.toFixed(2));
                           
                           
                        	tax_addition(tax_value,value_counter,newtaxamt.toFixed(2));             //call func to handle tax slab div
                   	}
                   		else  //if tax deselcted
                   			{
                   			var existing_taxamt = $('#' + value_counter + 'tax_amt').val();
                   			var amt = value_counter + 'amt';  
                   			var taxamt = value_counter + 'tax_amt';
                   	     	
                   	     	var taxrate = 0;
                   	     	var newtaxamt = (taxrate/100)*($('#' + amt).val());
                   	     	
                   	     	
                   	     	
                   	     	$('#' + taxamt).val(newtaxamt.toFixed(2));                              //update corresponding tax amt
                   	     	var taxtotal =  Number($('#taxtotal').val()) - existing_taxamt + Number(newtaxamt.toFixed(2));     //update txtotal
                   	        $('#taxtotal').val(taxtotal.toFixed(2));
                   	           
                   	           
                   	        var finalamt =  Number($('#grandtotal').val()) - existing_taxamt + Number(newtaxamt.toFixed(2));    //update grand total
                   	        $('#grandtotal').val(finalamt.toFixed(2));
                   	        
                   	        //now handle tax div , get all tax counter,div etc for that box
                   	        
                   	        var counter_index = tax_counter.indexOf(value_counter);
                   	        var divid = tax_div[counter_index];
                   	        var div_value = $("#" + divid).val();
                   	        var new_value = (Number(div_value) - existing_taxamt).toFixed(2);
                   	        
                   	        
                   	        if(new_value==0)
                         	  	{
                         	    	 $('#' + divid).closest('tr').remove();
                         	  	}
                   	        
                   	        //else subtract amount in that div
                   	        else
                   	        	
                   	        	$("#" + divid).val(new_value);
                   	        
                   	        tax_div[counter_index] =-1;
                   	        tax_amount[counter_index] = 0;
                   	        tax_rate[counter_index] =-1;
                   	        
                   			
                   			
                   			}
                       
                   	}
                   	
                   	
                   	
                   	//function to add/remove tax slab div

                   	function tax_addition(tax_val, number_count, tax_amt) {
                   		
                   		var nd = tax_val.toString().split(" ");                      //VAT 5.5
                       	var x = nd[1].toString().split(".");                         //5 5
                       	var n = nd[0] + x[0] + x[1];                                 //VAT55
                   		var intval = n;                                              //tax slab div ID prefix
                   		
                              //check if value_counter had contributed to any tax earlier - nullify its effects 

                          var counter_index = tax_counter.indexOf(number_count);
                          if(counter_index!=-1)                                           //if earlier entry exists
                                {
                                    //alert("entry for this box exists at index" + counter_index);
                                    var divid  = tax_div[counter_index];
                                    //alert("div id is " + divid);
                                    var amt   = tax_amount[counter_index];  //old amt
                                    //alert("old amount is " + amt);
                                    //alert("b4 subtraction amt is" + $('#' + divid).val());
                                    var subtract_amt = Number($('#' + divid).val()) - Number(amt);  //now that its changing, take amt subtract from div
                                    //alert("after subtraction amt is"  + subtract_amt);

                   			     if(subtract_amt==0)
                   			     {
                   			       //remove table row
                   			       $('#' + divid).closest('tr').remove();
                   			       tax_rate[counter_index]=-1;
                   			            
                   			     } 
                   			     
                   			     else
                   			         $('#' + divid).val(subtract_amt.toFixed(2));                      //update new value in tax slab div
                   			         
                   			         
                   			         
                                     //update new values, b4 that check if new tax type exists, find it in tax_rate array
                                     

                   	            var new_tax_index = tax_rate.indexOf(tax_val);
                   			   // alert("index of new tax entry" + tax_val + "is"  + new_tax_index);
                   			    
                   			    if(new_tax_index!=-1)                      //its present so add to its value , may be at same place/other box
                   							     {  
                   							       
                   							        var new_tax_value = $('#' + tax_div[new_tax_index]).val();
                   				//			        alert("value at div" + tax_val + "is" + new_tax_value);
                   							        var updated_val = Number(new_tax_value) + Number(tax_amt) ;
                   							        $('#' + tax_div[new_tax_index]).val(updated_val.toFixed(2));
                   					//		        alert("new value at div" + tax_val + "is" + updated_val);
                   									tax_rate[counter_index]  = tax_val;
                   									tax_div[counter_index]  = intval + 'check';
                   									tax_amount[counter_index]  = tax_amt;
                   						//			alert("array values are" + tax_val + " " + intval + 'check' + " " + number_count + " " + tax_amt  + "div value at" + tax_div[new_tax_index] + "is " + $('#' + tax_div[new_tax_index]).val());
                   							     
                   							     }
                   							     
                   							     
                                  else
                   				  {                                               // new tax entry doesnt exists
                   									     
                   			//		alert("create div for"   + tax_val);
                   					tax_rate[counter_index] = (tax_val);
                   				    tax_div[counter_index] = intval + 'check';  //div id of input box
                   				    tax_amount[counter_index] =(tax_amt);
                   				//	alert("doesnt have" + tax_val + "entry");
                   									
                   				    $( '<tr >' + 
                   						'<td colspan="5" >'+
                   						'<div class="form-group ">' + 
                   						'<label class="col-md-2 control-label">Tax@ ' + 
                   						tax_val +
                   						'</label>'+
                   						'<div class="col-md-3">'+ 
                   						'<input type="number" style="background-color:white" value="' + tax_amt + '" class="form-control no-border" readonly id="' +  intval +  'check" name="company_name" maxlength="30" name="username"  required="required" title=""  />'+
                   	  				    '</div>'+
                   						'</div>'+ 
                   						'</td>'+
                   						'</tr>').insertBefore('#taxfinalamt');
                   					// 	alert("array values are" + tax_val + " " + intval + 'check' + " " + number_count + " " + tax_amt  + "div value at" + tax_div[counter_index] + "is " + $('#' + tax_div[counter_index]).val());
                   									     
                   									     
                   				}    

                            }                                                                   // if loop ends(box entry found)
                            
                            
                   		else{                                                            //no entry as of now corresponding to the box , but if tax value is present elsewhere                      
                   		      
                 //  			alert("no entry of the box");
                   			var new_tax_index = tax_rate.indexOf(tax_val);
                   //		    alert("tax rate entry found at" + new_tax_index);
                   			
                   		    if(new_tax_index!=-1) //its present so add to its value
                   			{  

                   	//			alert("tax rate found at " + new_tax_index);
                   		//		alert("div id is" + tax_div[new_tax_index]);
                   				var new_tax_value = $('#' + tax_div[new_tax_index]).val();
                   	//			alert($('#' + tax_div[new_tax_index]).val());
                   		//		alert("existing amount at" + tax_val + "is" + new_tax_value);
                   				var updated_val = Number(new_tax_value) + Number(tax_amt) ;
                   			//	alert("now value is" + updated_val);
                   		//		alert("div to update is " + '#' + tax_div[new_tax_index]);
                   				$('#' + tax_div[new_tax_index]).val(updated_val.toFixed(2));
                   			//	alert("after updating at " + tax_div[new_tax_index] + " " + $('#' + tax_div[new_tax_index]).val());
                   				tax_rate.push(tax_val);
                   				tax_div.push(intval + 'check');  //div id of input box
                   				tax_counter.push(number_count);
                   				tax_amount.push(tax_amt);

                   			//	alert("array values are" + tax_val + " " + intval + 'check' + " " + number_count + " " + tax_amt  + "div value at" + tax_div[new_tax_index] + "is " + $('#' + tax_div[new_tax_index]).val());


                               }
                   		
                   		   else
                   			{

                   				//alert("tax entry for "   + tax_val + "not found");
                   				tax_rate.push(tax_val);
                   				tax_div.push(intval + 'check');  //div id of input box
                   				tax_counter.push(number_count);
                   				tax_amount.push(tax_amt);


                   				$( '<tr >' + 
                   				   '<td colspan="5" >'+
                   					'<div class="form-group ">' + 
                   					'<label class="col-md-2 control-label">Tax@ ' + 
                   					tax_val +
                   					'</label>'+
                   					'<div class="col-md-3">'+ 
                   					'<input type="number" value="' + tax_amt + '" class="form-control no-border" readonly id="' +  intval +  'check" name="company_name" maxlength="30" name="username"  required="required" title="" style="background-color:white" />'+
                   					'</div>'+
                   					'</div>'+ 
                   					'</td>'+
                   					'</tr>').insertBefore('#taxfinalamt');

                   					//alert("array values are" + tax_val + " " + intval + 'check' + " " + number_count + " " + tax_amt)  ;

                   			}




                   	}
                            
                   	}//function ends

                   	function delete1(o, number) {

                   		var index = box_counter.indexOf(number);
                           box_counter.splice(index, 1);
                         	var deleted_amt = $('#' + number + 'amt').val();
                         //	alert("deleted amt is " + deleted_amt);
                         	var deleted_tax_amt = $('#' + number + 'tax_amt').val();
                         //	alert("deleted tax amt is " + deleted_tax_amt);
                         	var sub_amount =  Number($('#subtotal').val())  - deleted_amt;
                         	$('#subtotal').val(sub_amount.toFixed(2));
                        // 	alert("sub total is after subtraction" + sub_amount);
                         	var taxfinal_amount =  Number($('#taxtotal').val())  - Number(deleted_tax_amt);
                         	$('#taxtotal').val(taxfinal_amount.toFixed(2));
                //         	alert("tax total is after subtraction" + taxfinal_amount.toFixed(2));
                  //       	alert("gtotal now is "  + Number($('#grandtotal').val()));
                         	
                         	var final_amount =  Number($('#grandtotal').val())  - (Number(deleted_amt) + Number(deleted_tax_amt));
                    //     	alert("final amt is" + final_amount.toFixed(2)); 
                         	$('#grandtotal').val(final_amount.toFixed(2));
                      //   	alert("grand total is after subtraction" + final_amount.toFixed(2));
                         	
                         	//get the index of this box
                         	
                         	var counter_index = tax_counter.indexOf(number);
                 //        	alert("found at index" + counter_index);
                         	if(counter_index!=-1)
                         	{
                         	 	 var tax_val = tax_rate[counter_index];  //VAT 5.5
                   //      	  	alert("tax rate in this box is " + tax_val);
                         	  
                   		
                         		var nd = tax_val.toString().split(" ");
                       		var x = nd[1].toString().split(".");     //5 5
                       		var n = nd[0] + x[0] + x[1];             //VAT55
                         	  
                         	  	var divid = n  + 'check';    //use diff ID of div
               //          	  	alert("div corresp to tax rate is"  + divid);
                         	  
                         	  	var div_value = $('#' + divid).val();
                 //        	  	alert("value in this tax rate div is" + div_value);
                         	  
                         	  	var old_amt = tax_amount[counter_index];
                   //      	  	alert("amt to be subtracted is" + old_amt);
                         	  
                         	  	var new_value = Number(div_value) - Number(old_amt);
                     //    	  	alert("new value in this tax rate div is " + new_value);
                         	  
                         	  	if(new_value==0)
                         	  	{
                         	    	 $('#' + divid).closest('tr').remove();
                         	  	}
                         	  
                         	  else
                         	    
                         	     $('#' + divid).val(new_value.toFixed(2));
                         	     
                         	  	tax_rate[counter_index] = -1;
                         	  	tax_counter[counter_index] = -1;
                         	  	tax_div[counter_index] = -1;
                         	  	tax_amount[counter_index] = -1;
                         	
                         	}
                         	
                         	 $(o).closest('tr').remove();
                         	
                   	}
                            
                            
                          
					          
					          
</script>

<script>


// on submit, for evry item , check read only property of product and tax so as to ensure right checks are done at the back end
$('#submit').click(function(){
	var estimate = {};
	  var estimateDetails= [];
	  //var customer;
	  estimate.estimateDetails = estimateDetails;
	  
		
		for(var i=0;i<box_counter.length;i++)
		{
		  var index = box_counter[i];
		  var product_identifier = index + "product_name";
		  var tax_identifier = index + "tax_rate";
		  if($('#' + product_identifier).val()=='')
		     	 alert("Please select a product ");
		     	 
		  //add checks for customer being selected, date and PO number(read only)
		  
		  else 
		  {
		    
			  var productName= $('#' + index + 'product_name').val();
		  	  var prod_id = $('#' + index + 'productlist option[value='+ productName +']').attr('prodid');
		  	  	var prodDel = $('#' + index + 'product_name').prop('readonly');
		  	  	var desc= $('#' + index + 'prod_desc').val();
				var quantity = $('#' + index + 'quantity').val();
				var price = $('#' + index + 'price').val();
				var amount = $('#' + index + 'amt').val();
				
				var tax = $('#' + index + 'tax_rate').val();
				var tax_id = $('#' + index + 'taxlist option[value="'+ tax +'"]').attr('taxid');
				var taxDel = $('#' + index + 'tax_rate').prop('readonly');
				var discount = $('#' + index + 'discount').val();
				var taxAmount = $('#' + index + 'tax_amt').val();
			
				//if read only attribute is true for product -> check against entire list no condition for product id
			
				var details = {
	  				"product": {
	  							"productName":null,
	  							"productDescription": null,
	  							"productTax":null,
	  							"productCategory":null,
	  							"costPrice": null,
	  							"productHOE": null,
	  							"sellingPrice": null,
	  							"productHOI": null,
	  							"company":null,
	  							"isDeleted": prodDel,
	  							"id": prod_id
							
	  						   },
	  				"description":desc,
	  				"quantity": quantity,
	  				"price": price,
	  				"discount" : discount,
	  				"subTotal": amount,
	  				"taxTotal": taxAmount,
	  				"tax": {
	  					      "taxType": null,
	  					      "taxName":null,
	  					      "taxAbbreviation" :null,
	  					      "taxDescription" :null,
	  					      "taxRate":null,
	  					      "isDeleted": taxDel,
	  					      "company":null,
	  					      "id" :tax_id
	  					
	  					},
	  			   "id" : null
				
				};
						  
				  
				estimate.estimateDetails.push(details);
			
		}
		
	}
	  
		var customer = $("#customer").val();
		var customer_id = $('#customer_names option[value="'+ customer +'"]').attr('customerid');
		var date = $("#date").val();
		
		estimate.customer = null;
		estimate.company = null;
		estimate.isEstimate = true;
		estimate.estimateSerialId = 0;  //no need
		estimate.estimateDate = date;
		estimate.estimateNumber = $("#estimate_number").val();
		estimate.estimateNotes = $("textarea#notes").val();
		
		estimate.estimateSubtotal = $("#subtotal").val();
		estimate.estimateTaxtotal = $("#taxtotal").val();
		estimate.estimateGrandtotal = $("#grandtotal").val();
		estimate.estimateAdvancetotal = 0; //chng at back end (gtotal - advance)
		estimate.estimateBalance = $("#grandtotal").val();
		estimate.estimatedeleted  = false;
		
		
		estimate.isInvoice = false;
		estimate.invoiceSerialId = 0, 
		estimate.invoiceNumber = null;
		estimate.invoiceDate  = null;
		estimate.invoiceDueinterval = 0;
		estimate.invoiceDuedate = null;
		estimate.invoiceSubtotal = null;
		estimate.invoiceTaxtotal = null;
		estimate.invoiceGrandtotal = null;
		estimate.invoiceAdvancetotal = null;
		estimate.invoiceBalance = null;
		estimate.invoiceNotes = null,
		estimate.isInvoicedeleted  = false;
		
		estimate.invoiceDetails = null;
		estimate.invoicePayments = null;
		estimate.estimatePayments = null;
		estimate.id = null;
		
		
		console.log(estimate);
		var p = JSON.stringify(estimate);
		console.log(customer_id);

		
		//ajax call
		var ccid = getCookie("CCID");
	 	var sid = getCookie("SID");
	 	var token = getCookie("TTID");

						
		
		$.ajax({
			   type : 'POST',
			   url  : '/Accounting/rest/estimate/update?' + $.param({	
				  
				   	"estimate" :p,
				   	"cid" : ccid,
				   	"id" : sid,
				   	"token" : token, "customerId" : customer_id}),
			    dataType :'json',
			    success: function(response, text, xhr) {
			               
			    	var estimate = JSON.parse(xhr.responseText);
			    	window.location.replace("viewEstimate.html?EstimateId=" + estimate.estimateNumber);
			    	
			    },
				error: function (a,b,c)
				{ 
					
					 console.log(c.responseText);
				}  
				  });
		
		
	});

function add_product()
{
	
	var name = $("#product_name").val();
	var tax = $("#prodtax_rate").val();
	var tid = $('datalist option[value="'+ tax +'"]').attr('taxid');
	var desc  = $("#product_desc").val();
	var cp = $("#cp").val();
	var sp = $("#sp").val();
	var category  = $("#category").val();
	var expen  = $("#expenditure").val();  
	var income  = $("#income").val();
	var discount = $("#discount").val();
	if(sp=='')
		sp=0;
	
	//CP IS COMPULSORY
	
	if(name=='' || cp=='')   
		{
		alert("Fill in all required fields");
		return true;
		
		}
	
	var product = {      
			
			"product_name":name,
			"product_desc": desc,
			"tax":                     //backend - search for tax obect from table with this id
				{
				 "tax_name":null,
				 "tax_abbreviation":null,
				 "tax_desc":null,
				 "tax_rate":null,
				 "company": null,//company object
				 "tax_id": tid,
				 "tax_recoverable":true
				 
				},
			"category":category,
			"cp": cp,
			"head_expenditure": expen,
				
			"sp": sp,
			"head_income": income,
			
			"company":
				{
				"company_id" :"CMP445"
				},
				
			"product_id": null,
			"discount":discount,
			"id":null
			
			
	};
	alert(product);
	console.log(product);
	
	//ajax call to add product, then on success -pass object back, add to the dropdown
	
	
	//product from back end
	var product1 = {      
			
			
			"product_name": name,
			"product_desc": desc,
			"tax":                     
				{
				 "tax_name": null,
				 "tax_abbreviation": "VAT",
				 "tax_desc":null,
				 "tax_rate": 5.5,
				 "company": null,   
				 "tax_id": "CMP123TAX2",
				 "tax_recoverable":true
				 
				},
				"category":category,
				"cp": cp,
				"head_expenditure": expen,
					
				"sp": sp,
				"head_income": income,
				
				"company":
					{
					"company_id" :"CMP445"
					},
					
				"product_id": "PROD44",
				"discount":discount,
				"id": 44
			
			
	};
	 
	 
	 //add this product to all existing box counters and to main product list
	 
	 product_list.push(product1);
	 
	 for(var i=0;i<box_counter.length;i++)
		 {
		 $('#' + box_counter[i] + 'productlist').append("<option prodid='" +  product1.product_id   + "' value='" +product1.product_name +  "'>" + "" +  product1.product_desc + "" + "</option>");
		 }
	 
	 $('#' + add_product_counter + 'productlist').val(product1.product_name);   //select this product in box where it got created
	 
	 $("#product_dialog").dialog('close');
	 
	 alert("product created");
	 
	 $("#product_name").val('');
		$("#tax_rate").val('');
		$("#product_desc").val('');
		$("#category").val('');
		$("#expenditure").val(''); //let value be ID
		$("#income").val('');
		$("#cp").val('');
		$("#sp").val('');
		$("#discount").val('');
	
	
	return false;
}



</script>

<!-- jQuery 
    <script src="js/jquery.js"></script>-->

<!-- Bootstrap Core JavaScript -->
<script src="jarvis/js/bootstrap.min.js"></script>

