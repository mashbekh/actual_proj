<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">

<title>Register</title>

<script type="text/javascript"
	src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
<script
	src="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.1/jquery-ui.js"
	type="text/javascript"></script>
<meta name="google-signin-client_id"
	content="230903295209-qfhj977v4aa60i0sjthdd0nuc0u1fkga.apps.googleusercontent.com">
<link
	href="http://ajax.aspnetcdn.com/ajax/jquery.ui/1.9.1/themes/blitzer/jquery-ui.css"
	rel="stylesheet" type="text/css" />


<script src="https://apis.google.com/js/platform.js" async defer></script>


<link rel="stylesheet"
	href="jarvis/js/datatables/responsive/css/datatables.responsive.css">

<!-- Bootstrap Core CSS -->
<link href="jarvis/css1/bootstrap.min.css" rel="stylesheet">

<!-- Custom CSS -->
<link href="jarvis/css1/sb-admin.css" rel="stylesheet">

<!-- Morris Charts CSS -->
<link href="jarvis/css1/plugins/morris.css" rel="stylesheet">

<!-- Custom Fonts -->
<link href="jarvis/css/font-icons/font-awesome/css/font-awesome.min.css"
	rel="stylesheet" type="text/css">

<link rel="stylesheet"
	href="jarvis/css/font-icons/entypo/css/entypo.css">



</head>


<style>
#pqr {
	background-color: #152F37;
}

#wrapper {
	background-color: white;
}

#pwrap {
	margin-top: 70px;
	background-color: white;
}

.ui-dialog-titlebar {
	border: 0;
	padding: .5em 1em;
	background: black;
	overflow: auto;
	zoom: 1;
}

#main {
	color: white;
	text-align: center;
}

#content {
	margin-left: 290px;
	font-size: 25px;
}


#msg {
	margin-left: 290px;
	font-size: 15px;
}

#form-panel {
	margin-left: 290px;
}
</style>

<script>

function setCookie(key, value, days) {
    var expires = new Date();
    expires.setTime(expires.getTime() + (days * 24 * 60 * 60 * 1000));
    document.cookie = key + '=' + value + ';expires=' + expires.toUTCString();
}
     

function getCookie(key) {
    var keyValue = document.cookie.match('(^|;) ?' + key + '=([^;]*)(;|$)');
    return keyValue ? keyValue[2] : null;
}

function check()
{
	
	var mailStatus = getCookie('mailCode');
	var userId = getCookie('identifier');
	var email = getCookie('email');
	
	if( mailStatus == 0 )
		{
		  $("#content").append("<br>Oops,  Something went wrong!<br> An email could not be sent to " +  email + " . <br>Please try to resend/ change email address.");
		
		}
	
	if(mailStatus == 1)
		{
		 $("#submit").prop('disabled', true);
    	 setTimeout(function()
    			{
    	 $("#submit").prop('disabled', false);
                }, 10*1000);

		 
		 $("#resend").prop('disabled', true);
    	 setTimeout(function()
    			{
    	 $("#resend").prop('disabled', false);
                }, 10*1000);
    	 
    	 $("#email").prop('readonly', true);
    	 setTimeout(function()
    			{
    	 $("#email").prop('readonly', false);
                }, 10*1000);

		 
		 
		 $('#msg').hide().delay(10000).show(0);
		$("#content").append("<br>An email has been sent to " +  email + " . <br>Please verify your email as a part of the verification process in the next few minutes.");
		}
	
	if(mailStatus == 2)  
		{
		 $("#submit").prop('disabled', true);
    	 setTimeout(function()
    			{
    	 $("#submit").prop('disabled', false);
                }, 10*1000);

		 
		 $("#resend").prop('disabled', true);
    	 setTimeout(function()
    			{
    	 $("#resend").prop('disabled', false);
                }, 10*1000);
    	 
    	 $("#email").prop('readonly', true);
    	 setTimeout(function()
    			{
    	 $("#email").prop('readonly', false);
                }, 10*1000);

		 
		 
		 $('#msg').hide().delay(10000).show(0);
		$("#content").append("<br>Oops, something went wrong!<br>Please verify your email again as a part of the verification process in the next few minutes.");
		
		}
	
	if(mailStatus == 3)  
	{
		var mail  = getCookie('newemail');
		$("#content").append("<br>User already exists with email: " +  mail + "<br>Please try to resend/ change email address.");
	
	}
	
	if(mailStatus == 4)  
	{
		var mail  = getCookie('newemail');
		$("#content").append("<br>User with email: " +  mail + " is under verification.<br>Please try to resend/ change email address or try again later.");
	
	}
	
	
	}


</script>

<body bgcolor="#E6E6FA" onload="check()">

	<div id="wrapper">

		<!-- Navigation -->
		<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation"
			id="pqr">
			<h1 id="main">SIMPLIFY TAX</h1>
		</nav>



		<div class="container-fluid">

			<br> <br> <br>
			<p id="content">
				
			</p>
			
			<br>
			
			<p id="msg">
			If you did not receive an email, try to resend or change email address;
			</p>
			
			<br><br>

			<!-- Page Heading -->
			<div class="row">
				<div class="col-lg-12">

					<div id="form-panel">
						<div class="row">
							<div class="col-lg-12">
								<form role="form" id="register" class="form-inline">



									<div class="form-group">
										<input class="form-control" id="email"
											placeholder="Enter Alternative Email" >
											
									</div>
									
									<input type="button" class="btn btn-primary" id="submit"
									onclick="return updateEmail()" 
									value="Submit">

									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
									&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;

									<div class="form-group">
									<input type="button" class="btn btn-primary" id="resend"
									onclick="return send()"  
									value="Resend">
								</div>
								</form>

								 <br> <br>

							</div>

						</div>
					</div>
					<!-- /.row -->


				</div>
				<!-- /.container-fluid -->

			</div>
			<!-- /#page-wrapper -->

		</div>
		<!-- /#wrapper -->
		</div>

		<!-- jQuery 
    <script src="js/jquery.js"></script>-->

		<!-- Bootstrap Core JavaScript -->
		<script src="jarvis/js/bootstrap.min.js"></script>
</body>

<script>
function send()
{
	
   
    var id = getCookie('identifier');
	$.ajax({
   		type : 'POST',
   		url  : '/Accounting/rest/register/sendMail?' + $.param({'id' : id }),
    	dataType : 'text',
 		success: function(response, text, xhr) {
           
         console.log(response);
         console.log(xhr.status);
         if(xhr.status == 200)
        	 {
        	  setCookie('mailCode',1);
        	  window.location.replace("confirmMail.html");
        	 }
           
           return false;
    },
    
    error: function (xhr) {

		var code = xhr.status;
		if(code == 404)
			{
				setCookie('conferror',"notfound",1);
 		   		window.location.replace("register.html");
			}
		if(code == 437)
			{
				setCookie('conferror',"session",1);
		   		window.location.replace("register.html");
			}
		
		if( code == 433)
		{
			setCookie('conferror',"exists",1);
		   	window.location.replace("login.html");
		}
		if(code == 434)
		{
			setCookie('conferror',"verifiedmail",1);
	   		window.location.replace("confirmMobile.html");
		}
		
		if(code == 439 || code == 438 || code == 515 || code== 500 || code == 516) //could not send
		{
			setCookie('mailCode',0);
      	  	window.location.replace("confirmMail.html");
		}
		
		return false;
	  }
    
	  });
	
	}
	
function updateEmail()
{
	var id = getCookie('identifier');
	var email = getCookie('email');
	
	var newEmail = $("#email").val();
	setCookie('newemail',newEmail);
	
	
	$.ajax({
   		type : 'POST',
   		url  : '/Accounting/rest/register/updateMail?' + $.param({'id' : id , "email" : newEmail}),
    	dataType : 'text',
 		success: function(response, text, xhr) {
           
         console.log(response);
         console.log(xhr.status);
         if(xhr.status == 200)
        	 {
        	 // successful in updating, sent mail and updated mail, set email cookie to new one
        	  setCookie('email',newEmail);
        	  setCookie('mailCode',1);
        	  window.location.replace("confirmMail.html");
        	 }
           
           return false;
    },
    
    error: function (xhr) {
    	 
    	var code = xhr.status;
    	if(code == 404)
		{
			setCookie('conferror',"notfound",1);
		   	window.location.replace("register.html");
		}
		if(code == 435)
		{
			setCookie('conferror',"session",1);
	   		window.location.replace("register.html");
		}
	
		if( code == 433)
		{
			setCookie('conferror',"exists",1);
	   		window.location.replace("login.html");
		}
		if(code == 434)
		{
			setCookie('conferror',"verifiedmail",1);
   			window.location.replace("confirmMobile.html");
		}
		if(code == 436)
		{
			setCookie('mailCode',3);
      	    window.location.replace("confirmMail.html");
		}
		if(code == 437)
		{
			setCookie('mailCode',4);
      	    window.location.replace("confirmMail.html");
		}
		
		if(code == 438 || code == 439 || code == 440 || code == 515 || code== 500 || code == 516)  //update failed/updated but could not send mail
		{
			setCookie('mailCode',0);
			window.location.replace("confirmMail.html");
		}
  	  	
		
	   return false;
	  }
    
	  });
	
	}



</script>
</html>